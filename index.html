<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flappy Bird</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #2c3e50;
            font-family: Arial, sans-serif;
            overflow: hidden;
        }
        
        #gameContainer {
            position: relative;
            width: 100%;
            height: 100%;
            max-width: 400px;
            max-height: 600px;
        }
        
        canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 2px solid #34495e;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        }
        
        .overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            width: 80%;
        }
        
        h1 {
            font-size: 48px;
            margin-bottom: 20px;
            color: #f1c40f;
        }
        
        p {
            font-size: 24px;
            margin: 10px 0;
        }
        
        .instructions {
            font-size: 20px;
            margin-top: 30px;
        }
        
        .game-over {
            color: #e74c3c;
        }
        
        .hidden {
            display: none;
        }

        @media (max-width: 480px) {
            h1 {
                font-size: 36px;
            }
            
            p {
                font-size: 18px;
            }
            
            .instructions {
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas"></canvas>
        
        <div id="startScreen" class="overlay">
            <h1>Flappy Bird</h1>
            <p class="instructions">prees space to play</p>
        </div>
        
        <div id="gameOverScreen" class="overlay hidden">
            <h1 class="game-over">Game Over</h1>
            <p id="finalScore">score: 0</p>
            <p class="instructions">prees space to play</p>
        </div>
    </div>

    <script>
        // عناصر DOM
        const gameContainer = document.getElementById('gameContainer');
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const startScreen = document.getElementById('startScreen');
        const gameOverScreen = document.getElementById('gameOverScreen');
        const finalScoreElement = document.getElementById('finalScore');
        
        // الألوان
        const SKY_BLUE = '#71C5CF';
        const WHITE = '#FFFFFF';
        const BLACK = '#000000';
        const GREEN = '#4C9141';
        const BROWN = '#A5714E';
        const YELLOW = '#FFD93D';
        const ORANGE = '#FF9900';
        const RED = '#EB4034';
        
        // متغيرات اللعبة
        let gameState = "start"; // start, playing, game_over
        let score = 0;
        let highScore = 0;
        let scrollOffset = 0;
        let pipeTimer = 0;
        let backgroundElements = [];
        let canvasWidth = 0;
        let canvasHeight = 0;
        let aspectRatio = 400/600; // النسبة الأصلية للعبة
        
        // وظيفة ضبط حجم canvas
        function resizeCanvas() {
            const containerWidth = gameContainer.clientWidth;
            const containerHeight = gameContainer.clientHeight;
            
            // حساب الحجم مع الحفاظ على النسبة
            let newWidth = containerWidth;
            let newHeight = containerWidth / aspectRatio;
            
            if (newHeight > containerHeight) {
                newHeight = containerHeight;
                newWidth = containerHeight * aspectRatio;
            }
            
            canvas.width = newWidth;
            canvas.height = newHeight;
            canvasWidth = newWidth;
            canvasHeight = newHeight;
            
            // إعادة إنشاء عناصر الخلفية بناءً على الحجم الجديد
            backgroundElements = [];
            for (let i = 0; i < 10; i++) {
                let x = Math.random() * canvasWidth;
                let y = 100 + Math.random() * (canvasHeight - 200);
                let size = 2 + Math.random() * 3;
                backgroundElements.push({x, y, size});
            }
            
            // إعادة ضبط الأرض إذا كانت موجودة
            if (ground) {
                ground.y = canvasHeight - (80 * (canvasHeight / 600));
                ground.generatePattern();
            }
        }
        
        // الاستماع لتغير حجم النافذة
        window.addEventListener('resize', resizeCanvas);
        
        // الطائر
        class Bird {
            constructor() {
                this.x = canvasWidth * 0.2; // 20% من عرض الشاشة
                this.y = canvasHeight / 2;
                this.radius = 15 * (canvasWidth / 400); // حجم نسبي
                this.velocity = 0;
                this.gravity = 0.5 * (canvasHeight / 600);
                this.jumpStrength = -8 * (canvasHeight / 600);
                this.angle = 0;
                this.flapCounter = 0;
                this.wingUp = false;
            }
            
            draw() {
                // جسم الطائر
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fillStyle = YELLOW;
                ctx.fill();
                ctx.closePath();
                
                // العين
                const eyeSize = 8 * (canvasWidth / 400);
                ctx.beginPath();
                ctx.arc(this.x + this.radius * 0.5, this.y - this.radius * 0.3, eyeSize, 0, Math.PI * 2);
                ctx.fillStyle = WHITE;
                ctx.fill();
                ctx.closePath();
                
                ctx.beginPath();
                ctx.arc(this.x + this.radius * 0.7, this.y - this.radius * 0.3, eyeSize * 0.5, 0, Math.PI * 2);
                ctx.fillStyle = BLACK;
                ctx.fill();
                ctx.closePath();
                
                // المنقار
                ctx.beginPath();
                ctx.moveTo(this.x + this.radius, this.y - this.radius * 0.1);
                ctx.lineTo(this.x + this.radius * 1.7, this.y);
                ctx.lineTo(this.x + this.radius, this.y + this.radius * 0.1);
                ctx.fillStyle = ORANGE;
                ctx.fill();
                ctx.closePath();
                
                // الأجنحة - تتحرك
                this.flapCounter += 1;
                if (this.flapCounter > 5) {
                    this.wingUp = !this.wingUp;
                    this.flapCounter = 0;
                }
                
                let wingYOffset = this.wingUp ? -this.radius * 0.3 : this.radius * 0.3;
                ctx.beginPath();
                ctx.ellipse(this.x - this.radius, this.y + wingYOffset, this.radius * 0.7, this.radius * 0.3, 0, 0, Math.PI * 2);
                ctx.fillStyle = YELLOW;
                ctx.fill();
                ctx.closePath();
            }
            
            update() {
                this.velocity += this.gravity;
                this.y += this.velocity;
                
                // تحديد زاوية الطائر بناء على السرعة
                this.angle = -this.velocity * 2;
                this.angle = Math.max(-30, Math.min(this.angle, 45));
            }
            
            jump() {
                this.velocity = this.jumpStrength;
                playJumpSound();
            }
            
            checkCollision(pipes, groundY) {
                // الاصطدام بالأرض
                if (this.y + this.radius >= groundY) {
                    return true;
                }
                
                // الاصطدام بالأنابيب
                for (let pipe of pipes) {
                    // الأنابيب العلوية
                    if (this.x + this.radius > pipe.x && 
                        this.x - this.radius < pipe.x + pipe.width && 
                        this.y - this.radius < pipe.topHeight) {
                        return true;
                    }
                    
                    // الأنابيب السفلية
                    if (this.x + this.radius > pipe.x && 
                        this.x - this.radius < pipe.x + pipe.width && 
                        this.y + this.radius > pipe.bottomY) {
                        return true;
                    }
                }
                
                return false;
            }
        }
        
        // الأنابيب (تم تعديلها لجعلها أسهل)
        class Pipe {
            constructor() {
                this.width = 70 * (canvasWidth / 400);
                this.x = canvasWidth;
                this.gap = 160 * (canvasHeight / 600); // زيادة الفجوة بين الأنابيب لجعل اللعبة أسهل
                this.topHeight = (80 + Math.random() * (canvasHeight - 300)) * (canvasHeight / 600); // جعل الأنابيب أقصر
                this.bottomY = this.topHeight + this.gap;
                this.speed = 3.0 * (canvasWidth / 400); // تقليل سرعة الأنابيب
                this.passed = false;
                this.color = GREEN;
                this.highlight = '#427D37'; // لون التظليل
            }
            
            draw() {
                // الأنبوب العلوي
                ctx.fillStyle = this.color;
                ctx.fillRect(this.x, 0, this.width, this.topHeight);
                
                ctx.fillStyle = this.highlight;
                ctx.fillRect(this.x, this.topHeight - 20 * (canvasHeight / 600), this.width, 20 * (canvasHeight / 600));
                ctx.fillRect(this.x - 2 * (canvasWidth / 400), 0, 5 * (canvasWidth / 400), this.topHeight);
                
                // الأنبوب السفلي
                ctx.fillStyle = this.color;
                ctx.fillRect(this.x, this.bottomY, this.width, canvasHeight - this.bottomY);
                
                ctx.fillStyle = this.highlight;
                ctx.fillRect(this.x, this.bottomY, this.width, 20 * (canvasHeight / 600));
                ctx.fillRect(this.x - 2 * (canvasWidth / 400), this.bottomY, 5 * (canvasWidth / 400), canvasHeight - this.bottomY);
            }
            
            update() {
                this.x -= this.speed;
            }
            
            isOffScreen() {
                return this.x + this.width < 0;
            }
        }
        
        // السحب
        class Cloud {
            constructor() {
                this.x = canvasWidth + Math.random() * 100;
                this.y = 50 + Math.random() * 150;
                this.speed = (0.5 + Math.random()) * (canvasWidth / 400);
                this.size = (30 + Math.random() * 30) * (canvasWidth / 400);
            }
            
            draw() {
                ctx.fillStyle = WHITE;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.beginPath();
                ctx.arc(this.x + this.size * 0.5, this.y - this.size * 0.3, this.size * 0.7, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.beginPath();
                ctx.arc(this.x + this.size, this.y, this.size * 0.8, 0, Math.PI * 2);
                ctx.fill();
            }
            
            update() {
                this.x -= this.speed;
                if (this.x + this.size < 0) {
                    this.x = canvasWidth + Math.random() * 100;
                    this.y = 50 + Math.random() * 150;
                }
            }
        }
        
        // الأرض
        class Ground {
            constructor() {
                this.y = canvasHeight - 80 * (canvasHeight / 600);
                this.x = 0;
                this.speed = 2.5 * (canvasWidth / 400); // تقليل سرعة الأرض لتتناسب مع سرعة الأنابيب
                this.pattern = [];
                this.generatePattern();
            }
            
            generatePattern() {
                this.pattern = [];
                const patternWidth = 20 * (canvasWidth / 400);
                for (let i = 0; i < canvasWidth + 100; i += patternWidth) {
                    let height = (5 + Math.random() * 10) * (canvasHeight / 600);
                    this.pattern.push({x: i, height});
                }
            }
            
            draw() {
                ctx.fillStyle = BROWN;
                ctx.fillRect(0, this.y, canvasWidth, canvasHeight - this.y);
                
                // العشب
                ctx.fillStyle = GREEN;
                const patternWidth = 20 * (canvasWidth / 400);
                for (let item of this.pattern) {
                    ctx.fillRect(item.x - this.x % patternWidth, this.y, patternWidth, 5 * (canvasHeight / 600));
                    
                    // نتوءات العشب
                    for (let j = 0; j < 3; j++) {
                        let offset = Math.random() * 15 * (canvasWidth / 400);
                        ctx.beginPath();
                        ctx.moveTo(item.x - this.x % patternWidth + offset, this.y);
                        ctx.lineTo(item.x - this.x % patternWidth + offset, this.y - item.height);
                        ctx.lineWidth = 2 * (canvasWidth / 400);
                        ctx.strokeStyle = GREEN;
                        ctx.stroke();
                    }
                }
            }
            
            update() {
                this.x += this.speed;
            }
        }
        
        // الجسيمات
        class Particle {
            constructor(x, y, color) {
                this.x = x;
                this.y = y;
                this.color = color;
                this.size = (2 + Math.random() * 3) * (canvasWidth / 400);
                this.speedX = (-2 + Math.random() * 4) * (canvasWidth / 400);
                this.speedY = (-2 + Math.random() * 4) * (canvasHeight / 600);
                this.life = 20 + Math.random() * 20;
            }
            
            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fillStyle = this.color;
                ctx.fill();
            }
            
            update() {
                this.x += this.speedX;
                this.y += this.speedY;
                this.life -= 1;
                this.size = Math.max(0, this.size - 0.1);
                return this.life <= 0;
            }
        }
        
        // إنشاء كائنات اللعبة
        let bird = null;
        let pipes = [];
        let clouds = [];
        let ground = null;
        let particles = [];
        
        // تهيئة اللعبة
        function initGame() {
            resizeCanvas();
            
            bird = new Bird();
            pipes = [];
            clouds = Array.from({length: 5}, () => new Cloud());
            ground = new Ground();
            particles = [];
        }
        
        // الأصوات
        function playJumpSound() {
            // توليد صوت القفز
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = 400;
            oscillator.type = 'sine';
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
            
            oscillator.start();
            oscillator.stop(audioContext.currentTime + 0.1);
        }
        
        function playScoreSound() {
            // توليد صوت النقاط
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = 800;
            oscillator.type = 'sine';
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.15);
            
            oscillator.start();
            oscillator.stop(audioContext.currentTime + 0.15);
        }
        
        function playHitSound() {
            // توليد صوت الاصطدام
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = 200;
            oscillator.type = 'sine';
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
            
            oscillator.start();
            oscillator.stop(audioContext.currentTime + 0.3);
        }
        
        function playDieSound() {
            // توليد صوت الموت
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = 150;
            oscillator.type = 'sine';
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
            
            oscillator.start();
            oscillator.stop(audioContext.currentTime + 0.5);
        }
        
        // إعادة تعيين اللعبة
        function resetGame() {
            bird = new Bird();
            pipes = [];
            particles = [];
            score = 0;
            pipeTimer = 0;
            gameState = "start";
            startScreen.classList.remove('hidden');
            gameOverScreen.classList.add('hidden');
        }
        
        // التحكم في الأحداث
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space') {
                if (gameState === "start") {
                    gameState = "playing";
                    startScreen.classList.add('hidden');
                } else if (gameState === "playing") {
                    bird.jump();
                } else if (gameState === "game_over") {
                    resetGame();
                }
            }
        });
        
        canvas.addEventListener('click', () => {
            if (gameState === "start") {
                gameState = "playing";
                startScreen.classList.add('hidden');
            } else if (gameState === "playing") {
                bird.jump();
            } else if (gameState === "game_over") {
                resetGame();
            }
        });
        
        // دعم اللمس للأجهزة المحمولة
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            if (gameState === "start") {
                gameState = "playing";
                startScreen.classList.add('hidden');
            } else if (gameState === "playing") {
                bird.jump();
            } else if (gameState === "game_over") {
                resetGame();
            }
        });
        
        // دورة اللعبة الرئيسية
        function gameLoop() {
            // تحديث حالة اللعبة
            scrollOffset += 0.5;
            
            // تحديث السحب
            for (let cloud of clouds) {
                cloud.update();
            }
            
            // تحديث الأرض
            ground.update();
            
            // تحديث الجسيمات
            particles = particles.filter(p => !p.update());
            
            if (gameState === "playing") {
                // تحديث الطائر
                bird.update();
                
                // إنشاء أنابيب جديدة (بمعدل أبطأ)
                pipeTimer += 1;
                if (pipeTimer > 120) { // كل 120 إطار (حوالي 2 ثانية) بدلاً من 90
                    pipes.push(new Pipe());
                    pipeTimer = 0;
                }
                
                // تحديث الأنابيب
                for (let pipe of pipes) {
                    pipe.update();
                    
                    // حساب النقاط
                    if (!pipe.passed && pipe.x + pipe.width < bird.x) {
                        pipe.passed = true;
                        score += 1;
                        playScoreSound();
                        
                        // إضافة جسيمات عند تسجيل النقاط
                        for (let i = 0; i < 10; i++) {
                            particles.push(new Particle(
                                pipe.x + pipe.width / 2,
                                pipe.topHeight + pipe.gap / 2,
                                YELLOW
                            ));
                        }
                    }
                }
                
                // إزالة الأنابيب التي خرجت من الشاشة
                pipes = pipes.filter(pipe => !pipe.isOffScreen());
                
                // التحقق من الاصطدام
                if (bird.checkCollision(pipes, ground.y)) {
                    playHitSound();
                    playDieSound();
                    gameState = "game_over";
                    highScore = Math.max(highScore, score);
                    
                    // إضافة جسيمات عند الاصطدام
                    for (let i = 0; i < 20; i++) {
                        particles.push(new Particle(
                            bird.x,
                            bird.y,
                            RED
                        ));
                    }
                    
                    // عرض شاشة نهاية اللعبة
                    finalScoreElement.textContent = `النقاط: ${score}`;
                    gameOverScreen.classList.remove('hidden');
                }
            }
            
            // الرسم
            // الخلفية
            ctx.fillStyle = SKY_BLUE;
            ctx.fillRect(0, 0, canvasWidth, canvasHeight);
            
            // عناصر الخلفية البعيدة
            ctx.fillStyle = '#C8E6FF';
            for (let elem of backgroundElements) {
                let newX = (elem.x - scrollOffset * 0.2) % (canvasWidth + 50) - 25;
                ctx.beginPath();
                ctx.arc(newX, elem.y, elem.size, 0, Math.PI * 2);
                ctx.fill();
            }
            
            // السحب
            for (let cloud of clouds) {
                cloud.draw();
            }
            
            // الأنابيب
            for (let pipe of pipes) {
                pipe.draw();
            }
            
            // الأرض
            ground.draw();
            
            // الطائر
            if (gameState !== "game_over" || Date.now() % 1000 < 500) {
                bird.draw();
            }
            
            // الجسيمات
            for (let particle of particles) {
                particle.draw();
            }
            
            // النقاط
            const fontSize = 36 * (canvasWidth / 400);
            ctx.font = `${fontSize}px Arial`;
            ctx.fillStyle = WHITE;
            ctx.textAlign = "left";
            ctx.fillText(`Score: ${score}`, 10 * (canvasWidth / 400), 40 * (canvasHeight / 600));
            
            ctx.textAlign = "right";
            ctx.fillText(`High Score: ${highScore}`, canvasWidth - 10 * (canvasWidth / 400), 40 * (canvasHeight / 600));
            
            // الاستمرار في دورة اللعبة
            requestAnimationFrame(gameLoop);
        }
        
        // بدء اللعبة
        initGame();
        gameLoop();
    </script>
</body>
</html>
